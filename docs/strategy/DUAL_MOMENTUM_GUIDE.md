# åŒæ ¸åŠ¨é‡è½®åŠ¨ç­–ç•¥ - ä½¿ç”¨æŒ‡å—

## ðŸ“– ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [ç­–ç•¥åŽŸç†](#ç­–ç•¥åŽŸç†)
3. [å‚æ•°è°ƒä¼˜](#å‚æ•°è°ƒä¼˜)
4. [å›žæµ‹åˆ†æž](#å›žæµ‹åˆ†æž)
5. [å®žç›˜ä½¿ç”¨](#å®žç›˜ä½¿ç”¨)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸€é”®è¿è¡Œå›žæµ‹

```bash
cd /home/wangxinghan/codetree/ai-trading-system
python3 tools/backtest_dual_momentum.py
```

**é¢„æœŸç»“æžœï¼š**
- è‡ªåŠ¨ä¸‹è½½ ETF æ•°æ®ï¼ˆæ²ªæ·±300ã€åˆ›ä¸šæ¿50ã€çº³æŒ‡ã€é»„é‡‘ã€å›½å€ºï¼‰
- è¿è¡Œ2020-è‡³ä»Šçš„å®Œæ•´å›žæµ‹
- è¾“å‡ºå›žæµ‹æŠ¥å‘Šï¼ˆæ”¶ç›ŠçŽ‡ã€å›žæ’¤ã€å¤æ™®æ¯”çŽ‡ç­‰ï¼‰
- ç”Ÿæˆå‡€å€¼æ›²çº¿å›¾
- ä¿å­˜äº¤æ˜“è®°å½•åˆ° CSV

### 2. æŸ¥çœ‹ç­–ç•¥æ–‡æ¡£

```bash
cat strategies/dual_momentum_strategy.md
```

å®Œæ•´çš„ç­–ç•¥é€»è¾‘ã€å‚æ•°è¯´æ˜Žã€é£ŽæŽ§è§„åˆ™éƒ½åœ¨è¿™ä¸ªæ–‡æ¡£ä¸­ã€‚

---

## ðŸ“Š ç­–ç•¥åŽŸç†

### æ ¸å¿ƒæ€æƒ³

**æ°¸è¿œæŒæœ‰æœ€å¼ºè¶‹åŠ¿çš„èµ„äº§**

è¿™ä¸ªç­–ç•¥ä¸é¢„æµ‹æœªæ¥ï¼Œåªåº”å¯¹å½“ä¸‹ã€‚é€šè¿‡ä¸¤ä¸ªæ¨¡å—æ¥å®žçŽ°ï¼š

#### 1. ç»å¯¹åŠ¨é‡ï¼ˆè¿‡æ»¤å™¨ï¼‰ðŸ›¡ï¸

```
æ¡ä»¶: å½“å‰ä»·æ ¼ > 200æ—¥å‡çº¿
ä½œç”¨: åªåœ¨ç‰›å¸‚å‚ä¸Žï¼Œç†Šå¸‚ç©ºä»“
```

**ä¾‹å­ï¼š**
- æ²ªæ·±300 å½“å‰3800ç‚¹ï¼Œ200æ—¥å‡çº¿3600ç‚¹ â†’ âœ… é€šè¿‡
- åˆ›ä¸šæ¿50 å½“å‰2200ç‚¹ï¼Œ200æ—¥å‡çº¿2400ç‚¹ â†’ âŒ ä¸é€šè¿‡

#### 2. ç›¸å¯¹åŠ¨é‡ï¼ˆé€‰æ‹©å™¨ï¼‰ðŸ†

```
å¾—åˆ† = (å½“å‰ä»·æ ¼ / 60æ—¥å‰ä»·æ ¼) - 1
é€‰æ‹©: å¾—åˆ†æœ€é«˜çš„èµ„äº§
```

**ä¾‹å­ï¼š**
- æ²ªæ·±300 è¿‡åŽ»60æ—¥æ¶¨å¹… +5% â†’ å¾—åˆ† 0.05
- çº³æŒ‡ETF è¿‡åŽ»60æ—¥æ¶¨å¹… +12% â†’ å¾—åˆ† 0.12 âœ… é€‰è¿™ä¸ªï¼

### äº¤æ˜“æµç¨‹

```
æ¯20ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦1ä¸ªæœˆï¼‰:
1. è®¡ç®—æ‰€æœ‰èµ„äº§çš„ç»å¯¹åŠ¨é‡ â†’ ç­›é€‰å‡º"ç‰›å¸‚"èµ„äº§
2. è®¡ç®—ç›¸å¯¹åŠ¨é‡ â†’ æŽ’åºæ‰¾å‡ºæœ€å¼ºçš„
3. å¯¹æ¯”å½“å‰æŒä»“ â†’ å¦‚æžœä¸æ˜¯æœ€å¼ºçš„ï¼Œå°±æ¢æŽ‰
4. å¦‚æžœæ²¡æœ‰åˆæ ¼èµ„äº§ â†’ ç©ºä»“
```

---

## ðŸ”§ å‚æ•°è°ƒä¼˜

### å¯è°ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è°ƒæ•´æ–¹å‘ | å½±å“ |
|------|--------|---------|------|
| `absolute_period` (N) | 200 | 150 / 250 | è¶Šå¤§è¶Šä¿å®ˆï¼Œå¯¹ç†Šå¸‚ååº”è¶Šæ…¢ |
| `relative_period` (M) | 60 | 20 / 120 | è¶Šå°è¶Šæ¿€è¿›ï¼Œäº¤æ˜“é¢‘çŽ‡è¶Šé«˜ |
| `rebalance_days` (F) | 20 | 5 / 40 | è¶Šå°è¶Šé¢‘ç¹è°ƒä»“ï¼Œæˆæœ¬è¶Šé«˜ |
| `top_k` (K) | 1 | 2 / 3 | è¶Šå¤§è¶Šåˆ†æ•£ï¼Œæ³¢åŠ¨è¶Šå° |

### å¦‚ä½•è°ƒå‚

#### æ–¹æ³•1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `tools/backtest_dual_momentum.py` ä¸­çš„ `strategy_config`:

```python
strategy_config = {
    'absolute_period': 150,  # æ”¹æˆ150ï¼Œå¯¹è¶‹åŠ¿ååº”æ›´å¿«
    'relative_period': 120,   # æ”¹æˆ120ï¼Œçœ‹æ›´é•¿æœŸçš„åŠ¨é‡
    'rebalance_days': 10,     # æ”¹æˆ10ï¼Œæ›´é¢‘ç¹è°ƒä»“
    'top_k': 2,               # æ”¹æˆ2ï¼ŒæŒæœ‰å‰2ååˆ†æ•£é£Žé™©
}
```

#### æ–¹æ³•2ï¼šæ‰¹é‡æµ‹è¯•

åˆ›å»ºå‚æ•°æ‰«æè„šæœ¬ `test_params.py`ï¼š

```python
from tools.backtest_dual_momentum import *

# æµ‹è¯•ä¸åŒçš„Nå€¼
for N in [150, 200, 250]:
    for M in [20, 60, 120]:
        strategy_config['absolute_period'] = N
        strategy_config['relative_period'] = M
        
        strategy = DualMomentumStrategy(strategy_config)
        backtest = DualMomentumBacktest(1000000, 0.0002)
        report = backtest.run(strategy, data)
        
        print(f"N={N}, M={M} | å¹´åŒ–æ”¶ç›Š={report['annual_return']:.2%}, æœ€å¤§å›žæ’¤={report['max_drawdown']:.2%}")
```

---

## ðŸ“ˆ å›žæµ‹åˆ†æž

### æŸ¥çœ‹å›žæµ‹æŠ¥å‘Š

è¿è¡Œå›žæµ‹åŽï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
============================================================
å›žæµ‹æŠ¥å‘Š
============================================================
åˆå§‹èµ„é‡‘:          1,000,000.00 å…ƒ
æœ€ç»ˆèµ„äº§:          1,650,000.00 å…ƒ
æ€»æ”¶ç›ŠçŽ‡:                 65.00%
å¹´åŒ–æ”¶ç›ŠçŽ‡:               13.25%
æœ€å¤§å›žæ’¤:                -18.50%
å¤æ™®æ¯”çŽ‡:                  1.85
å¡çŽ›æ¯”çŽ‡:                  0.72
æ—¥èƒœçŽ‡:                   52.30%
äº¤æ˜“æ¬¡æ•°:                    24 æ¬¡
æ‰‹ç»­è´¹æ€»è®¡:            3,200.00 å…ƒ
============================================================
```

### å…³é”®æŒ‡æ ‡è§£è¯»

#### å¹´åŒ–æ”¶ç›ŠçŽ‡
- **å¥½**: > 15%
- **ä¸­ç­‰**: 8% - 15%
- **å·®**: < 8%

#### æœ€å¤§å›žæ’¤
- **å¥½**: < 20%
- **ä¸­ç­‰**: 20% - 30%
- **å·®**: > 30%

#### å¤æ™®æ¯”çŽ‡
- **å¥½**: > 2.0
- **ä¸­ç­‰**: 1.0 - 2.0
- **å·®**: < 1.0

### æŸ¥çœ‹äº¤æ˜“è®°å½•

```bash
cat dual_momentum_trades.csv
```

æˆ–ç”¨ Excel/Numbers æ‰“å¼€æŸ¥çœ‹æ¯ä¸€ç¬”äº¤æ˜“çš„è¯¦æƒ…ã€‚

---

## ðŸ’¼ å®žç›˜ä½¿ç”¨

### æ–¹æ³•1ï¼šæ‰‹åŠ¨äº¤æ˜“ï¼ˆæŽ¨èæ–°æ‰‹ï¼‰

1. **æ¯æœˆå›ºå®šæ—¶é—´è¿è¡Œç­–ç•¥**ï¼ˆæ¯”å¦‚æ¯æœˆæœ€åŽä¸€ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜å‰ï¼‰

```python
# è¿è¡Œç­–ç•¥èŽ·å–ä¿¡å·
from src.data.etf_data_fetcher import quick_fetch_etf_data
from src.core.strategy.dual_momentum_strategy import DualMomentumStrategy

data = quick_fetch_etf_data(years=3)
strategy = DualMomentumStrategy(strategy_config)
signals = strategy.generate_signals(data)

print(signals)
```

2. **æ ¹æ®ä¿¡å·æ‰‹åŠ¨ä¸‹å•**
   - ä¿¡å·=1 (ä¹°å…¥) â†’ åœ¨äº¤æ˜“è½¯ä»¶ä¸­æ‰‹åŠ¨ä¹°å…¥
   - ä¿¡å·=-1 (å–å‡º) â†’ æ‰‹åŠ¨å–å‡º
   - ä¿¡å·=0 (æŒæœ‰) â†’ ä¸æ“ä½œ

### æ–¹æ³•2ï¼šè‡ªåŠ¨äº¤æ˜“ï¼ˆéœ€è¦åŒèŠ±é¡ºæ¡Œé¢å®¢æˆ·ç«¯ï¼‰

ä½¿ç”¨å†…ç½®çš„æ¡Œé¢è‡ªåŠ¨åŒ–æ¨¡å—ï¼š

```python
from src.api.broker.tonghuashun_desktop import TonghuashunDesktop

broker = TonghuashunDesktop(config)
broker.connect()

# æ ¹æ®ä¿¡å·è‡ªåŠ¨ä¸‹å•
for _, signal_row in signals.iterrows():
    if signal_row['signal'] == 1:
        broker.buy(signal_row['code'], price, shares)
    elif signal_row['signal'] == -1:
        broker.sell(signal_row['code'], price, shares)
```

### æ–¹æ³•3ï¼šå†…ç½®æ¨¡æ‹Ÿè´¦æˆ·æµ‹è¯•

å…ˆåœ¨æ¨¡æ‹Ÿè´¦æˆ·ä¸­æµ‹è¯•ï¼š

```python
from src.core.simulator.paper_trading import PaperTradingAccount

account = PaperTradingAccount(initial_capital=1000000)
# ... æ‰§è¡Œäº¤æ˜“ ...
account.print_summary()
```

---

## ðŸ”¥ å®žæˆ˜æŠ€å·§

### 1. å‘¨æœŸé€‰æ‹©

- **æœˆåº¦è°ƒä»“ (F=20)**: é€‚åˆé•¿æœŸæŠ•èµ„è€…ï¼Œäº¤æ˜“æˆæœ¬ä½Ž
- **åŒå‘¨è°ƒä»“ (F=10)**: é€‚åˆä¸­æœŸæŠ•èµ„è€…ï¼Œå¹³è¡¡æ”¶ç›Šä¸Žæˆæœ¬
- **å‘¨åº¦è°ƒä»“ (F=5)**: é€‚åˆçŸ­æœŸæŠ•èµ„è€…ï¼Œéœ€è¦æŽ¥å—æ›´é«˜æˆæœ¬

### 2. æŒä»“æ•°é‡

- **K=1**: é›†ä¸­æœ€å¼ºèµ„äº§ï¼Œæ”¶ç›Šæ½œåŠ›å¤§ï¼Œä½†æ³¢åŠ¨ä¹Ÿå¤§
- **K=2**: åˆ†æ•£é£Žé™©ï¼Œå‡€å€¼æ›´å¹³æ»‘
- **K=3**: æ›´ç¨³å¥ï¼Œä½†å¯èƒ½ç¨€é‡Šæ”¶ç›Š

### 3. é£ŽæŽ§å»ºè®®

âœ… **å¿…é¡»ä¸¥æ ¼æ‰§è¡Œ**:
- å•ä¸ªæŒä»“æ­¢æŸ -10%
- å¸‚åœºå•æ—¥è·Œè¶… -5% ç«‹å³æ¸…ä»“
- åªäº¤æ˜“æµåŠ¨æ€§å¥½çš„ ETF

âŒ **ä¸è¦åš**:
- ä¸è¦é¢‘ç¹æ‰‹åŠ¨å¹²é¢„ç­–ç•¥
- ä¸è¦åœ¨ç­–ç•¥ä¿¡å·ä¹‹å¤–éšæ„åŠ ä»“
- ä¸è¦å› ä¸ºçŸ­æœŸå›žæ’¤å°±æ”¾å¼ƒç­–ç•¥

---

## â“ å¸¸è§é—®é¢˜

### Q1: æ•°æ®èŽ·å–å¤±è´¥æ€Žä¹ˆåŠžï¼Ÿ

**A:** æ£€æŸ¥ç½‘ç»œï¼Œæˆ–è€…ä½¿ç”¨ç¼“å­˜ï¼š

```python
fetcher = ETFDataFetcher()
data = fetcher.get_etf_pool_data(codes, start_date, end_date, use_cache=True)
```

### Q2: å›žæµ‹ç»“æžœä¸ç†æƒ³æ€Žä¹ˆåŠžï¼Ÿ

**A:** å°è¯•ï¼š
1. å»¶é•¿æ•°æ®å‘¨æœŸï¼ˆæµ‹è¯•æ›´é•¿æ—¶é—´ï¼‰
2. è°ƒæ•´å‚æ•°ï¼ˆå‚è€ƒä¸Šé¢çš„è°ƒå‚æŒ‡å—ï¼‰
3. å¢žåŠ  ETF æ± ï¼ˆåŠ å…¥æ›´å¤šå¤§ç±»èµ„äº§ï¼‰

### Q3: å®žç›˜ä¼šå’Œå›žæµ‹ä¸€æ ·å—ï¼Ÿ

**A:** ä¸ä¼šå®Œå…¨ä¸€æ ·ï¼Œå› ä¸ºï¼š
- å›žæµ‹æ²¡æœ‰æ»‘ç‚¹å’Œå†²å‡»æˆæœ¬
- å®žé™…äº¤æ˜“å¯èƒ½åœç‰Œæˆ–æµåŠ¨æ€§ä¸è¶³
- äººçš„æƒ…ç»ªå¹²é¢„

**å»ºè®®**: å®žç›˜é¢„æœŸæ”¶ç›Š = å›žæµ‹æ”¶ç›Š Ã— 0.7

### Q4: å¯ä»¥ç”¨äºŽè‚¡ç¥¨å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œä½†éœ€è¦ä¿®æ”¹ï¼š
1. æ‰©å¤§è§‚å¯Ÿæ± ï¼ˆä»Ž5ä¸ªETFæ‰©å±•åˆ°50-100åªè‚¡ç¥¨ï¼‰
2. å¢žåŠ  K å€¼ï¼ˆæŒæœ‰å‰10-20åï¼‰
3. åŠ å¼ºé£ŽæŽ§ï¼ˆä¸ªè‚¡æ³¢åŠ¨æ¯”ETFå¤§ï¼‰

### Q5: ä»€ä¹ˆæ—¶å€™åº”è¯¥åœæ­¢ä½¿ç”¨ç­–ç•¥ï¼Ÿ

**A:** å¦‚æžœå‡ºçŽ°ï¼š
- è¿žç»­6ä¸ªæœˆè·‘è¾“åŸºå‡†ï¼ˆå¦‚æ²ªæ·±300ï¼‰
- æœ€å¤§å›žæ’¤è¶…è¿‡ 40%
- å¸‚åœºç»“æž„æ€§æ”¹å˜ï¼ˆå¦‚äº¤æ˜“è§„åˆ™å˜åŒ–ï¼‰

---

## ðŸ“š æ‰©å±•é˜…è¯»

### ç­–ç•¥ä¼˜åŒ–æ–¹å‘

1. **åŠ¨æ€å‚æ•°**: æ ¹æ®å¸‚åœºæ³¢åŠ¨çŽ‡è‡ªåŠ¨è°ƒæ•´Nå’ŒM
2. **å¤šå› å­èžåˆ**: åŠ å…¥ä¼°å€¼ã€æˆäº¤é‡ç­‰å› å­
3. **é£Žé™©å¹³ä»·**: æ ¹æ®æ³¢åŠ¨çŽ‡åˆ†é…ä»“ä½
4. **æœºå™¨å­¦ä¹ **: ç”¨AIé¢„æµ‹åŠ¨é‡æŒç»­æ€§

### ç›¸å…³è®ºæ–‡

- *Dual Momentum Investing* by Gary Antonacci
- *A Quantitative Approach to Tactical Asset Allocation* by Faber (2007)

---

## ðŸ› ï¸ æŠ€æœ¯æ”¯æŒ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—: `logs/dual_momentum_backtest.log`
2. é˜…è¯»ç­–ç•¥æ–‡æ¡£: `strategies/dual_momentum_strategy.md`
3. æŸ¥çœ‹æºä»£ç : `src/core/strategy/dual_momentum_strategy.py`

---

**ç¥äº¤æ˜“é¡ºåˆ©ï¼è®°ä½ï¼šçºªå¾‹ > é¢„æµ‹ ðŸ“ˆ**
