# 基本面数据使用计划

## 为什么当前只用PE？

### 1. 优先级策略
- ✅ **PE策略先实现**：PE是最常用的估值指标，逻辑清晰
- ⏳ **PB/PS策略待实现**：类似逻辑，可以复用PE策略框架
- 📊 **市值/换手率**：更多作为辅助因子，而非独立策略

### 2. 避免策略重复
- PE和PB策略逻辑相似（都是基于历史分位数的均值回归）
- 如果同时使用，可能高度相关，组合策略中权重会分散
- **建议**：先验证PE策略效果，再决定是否实现PB

### 3. 数据质量考虑
- PE数据最稳定、最常用
- PB在某些行业（如银行）可能更有效，但需要分行业处理
- PS数据质量可能不如PE/PB稳定

## 这些数据的潜在用途

### 1. PB（市净率）✅ 应该用

**用途1：PB估值策略**（类似PE策略）
```python
# 逻辑：PB < 历史20%分位 → BUY，PB > 历史80%分位 → SELL
# 适用：银行、地产等重资产行业，PB比PE更有效
```

**用途2：PE+PB双重验证**
```python
# PE和PB都低估 → 更强买入信号
# PE和PB都高估 → 更强卖出信号
# 一个高估一个低估 → 中性（可能行业特性）
```

**实现建议**：
- 可以快速实现PB策略（复用PE策略代码）
- 或实现PE+PB综合策略（多因子打分）

### 2. PS（市销率）⚠️ 可选

**用途**：
- 适用于亏损或微利公司（PE无效时）
- 成长股估值（营收比利润更稳定）
- 周期性行业（利润波动大，营收更稳定）

**问题**：
- PS数据质量可能不如PE/PB
- 使用场景相对较少

**建议**：优先级较低，可以后续实现

### 3. market_cap（总市值）✅ 应该用

**用途1：股票池过滤**
```python
# 只买大盘股（市值 > 100亿）→ 降低风险
# 只买小盘股（市值 < 50亿）→ 追求弹性
```

**用途2：仓位调整因子**
```python
# 大盘股（流动性好）→ 可以更高仓位
# 小盘股（流动性差）→ 降低仓位上限
position = base_position * (1 - min(market_cap / 1000亿, 0.2))
```

**用途3：行业/板块分析**
```python
# 按市值分组回测，验证策略在不同市值股票上的表现
```

**实现建议**：
- 在回测前过滤股票池（最简单）
- 在策略中作为仓位调整因子（需要修改策略接口）

### 4. turnover_rate（换手率）✅ 应该用

**用途1：流动性过滤**
```python
# 换手率 < 0.5% → 流动性差，避免交易
# 换手率 > 10% → 异常放量，可能是风险信号
```

**用途2：技术面辅助指标**
```python
# 放量突破（换手率 > 3%）→ 增强信号
# 缩量回调（换手率 < 1%）→ 可能是假突破
```

**用途3：替代volume验证**
```python
# 当前技术策略用 volume/20日均量 验证
# 换手率更标准化，不受股票规模影响
# 可以替代或补充volume验证
```

**实现建议**：
- 在技术策略中作为量比验证的补充
- 或作为独立的流动性过滤条件

## 快速实现建议

### 优先级1：PB策略（最容易）

**实现方式**：直接复用PE策略代码
```python
# 创建 src/strategies/fundamental_pb.py
# 逻辑完全一样，只是把 pe_ttm 换成 pb
```

**优势**：
- 代码复用率高
- 逻辑清晰
- 可以快速验证效果

### 优先级2：市值过滤（最简单）

**实现方式**：在回测前过滤
```python
# tools/backtest/batch_backtest.py
def filter_by_market_cap(stocks, min_cap=50亿, max_cap=10000亿):
    # 过滤股票池
    pass
```

**优势**：
- 不需要修改策略
- 可以快速验证大盘股vs小盘股的表现差异

### 优先级3：换手率辅助（增强现有策略）

**实现方式**：在技术策略中补充
```python
# 例如在 MA策略中
if turnover_rate > 3.0:  # 异常放量
    confidence *= 1.1  # 增强信号
elif turnover_rate < 0.5:  # 流动性差
    confidence *= 0.8  # 削弱信号
```

**优势**：
- 不需要新策略
- 直接增强现有策略效果

### 优先级4：PE+PB综合策略

**实现方式**：多因子打分
```python
# 综合PE和PB的分位数
pe_score = 1 - pe_quantile  # PE越低分数越高
pb_score = 1 - pb_quantile  # PB越低分数越高
combined_score = (pe_score + pb_score) / 2

if combined_score > 0.8:  # 都低估
    return BUY
elif combined_score < 0.2:  # 都高估
    return SELL
```

**优势**：
- 比单一PE策略更稳健
- 可以过滤行业特性导致的误判

## 实施建议

### 短期（1-2天）

1. ✅ **实现PB策略**
   - 复用PE策略代码
   - 注册到组合策略
   - 回测验证效果

2. ✅ **添加市值过滤**
   - 在回测工具中添加过滤选项
   - 验证大盘股vs小盘股的表现

### 中期（1周）

3. ✅ **换手率辅助**
   - 在技术策略中补充换手率验证
   - 替代或补充volume验证

4. ✅ **PE+PB综合策略**
   - 实现多因子打分策略
   - 验证是否比单一PE策略更好

### 长期（可选）

5. ⏳ **PS策略**（如果PB效果好）
6. ⏳ **市值动态仓位调整**（需要修改策略接口）

## 总结

**当前只用PE的原因**：
1. 优先级：先实现最常用的PE策略
2. 避免重复：PE和PB策略逻辑相似
3. 验证效果：先验证PE策略，再决定是否扩展

**应该使用这些数据的原因**：
1. **PB**：银行/地产等行业更有效，可以快速实现
2. **市值**：可以作为过滤条件，简单有效
3. **换手率**：可以增强现有技术策略，提升信号质量
4. **PS**：优先级较低，可以后续实现

**建议**：优先实现PB策略和市值过滤，这两个最容易且效果明显。
